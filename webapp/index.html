<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>–¶–∏—Ñ—Ä–æ–≤–æ–π –£–º–Ω–∏–∫</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
:root {
    --bg: #0f0f1a;
    --surface: #1a1a2e;
    --surface2: #232340;
    --accent: #7c3aed;
    --accent2: #a855f7;
    --success: #10b981;
    --warning: #f59e0b;
    --danger: #ef4444;
    --text: #e2e8f0;
    --text2: #94a3b8;
    --border: #334155;
    --glow: rgba(124, 58, 237, 0.3);
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, system-ui, sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
}

/* === HEADER === */
.header {
    padding: 20px 16px 12px;
    text-align: center;
    position: relative;
}
.header::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 16px; right: 16px;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--accent), transparent);
}
.logo { font-size: 28px; margin-bottom: 4px; }
.title { font-size: 20px; font-weight: 700; }
.subtitle { font-size: 13px; color: var(--text2); margin-top: 2px; }

/* === TABS === */
.tabs {
    display: flex;
    padding: 12px 16px 0;
    gap: 4px;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
}
.tab {
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 600;
    white-space: nowrap;
    cursor: pointer;
    transition: all 0.2s;
    background: var(--surface);
    color: var(--text2);
    border: 1px solid var(--border);
}
.tab.active {
    background: var(--accent);
    color: white;
    border-color: var(--accent);
    box-shadow: 0 0 20px var(--glow);
}

/* === CONTENT === */
.content { padding: 16px; }
.panel { display: none; }
.panel.active { display: block; }

/* === INPUT SECTION === */
.input-card {
    background: var(--surface);
    border-radius: 16px;
    padding: 20px;
    margin-bottom: 12px;
    border: 1px solid var(--border);
}
.input-label {
    font-size: 13px;
    color: var(--text2);
    margin-bottom: 8px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}
.url-input {
    width: 100%;
    padding: 14px 16px;
    background: var(--surface2);
    border: 2px solid var(--border);
    border-radius: 12px;
    color: var(--text);
    font-size: 15px;
    outline: none;
    transition: border-color 0.2s;
}
.url-input:focus { border-color: var(--accent); }
.url-input::placeholder { color: var(--text2); opacity: 0.6; }

/* === RECORD BUTTON === */
.record-section { text-align: center; padding: 20px 0; }
.record-btn {
    width: 80px; height: 80px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    border: none;
    cursor: pointer;
    position: relative;
    transition: all 0.3s;
    box-shadow: 0 4px 30px var(--glow);
}
.record-btn:active { transform: scale(0.95); }
.record-btn.recording {
    animation: pulse-record 1.5s infinite;
    background: linear-gradient(135deg, var(--danger), #dc2626);
    box-shadow: 0 4px 30px rgba(239, 68, 68, 0.4);
}
.record-btn svg {
    width: 32px; height: 32px;
    fill: white;
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
}
.record-time {
    margin-top: 12px;
    font-size: 16px;
    font-weight: 600;
    color: var(--text2);
}
    0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
    50% { box-shadow: 0 0 0 20px rgba(239, 68, 68, 0); }
}

/* === ACTION BUTTON === */
.action-btn {
    width: 100%;
    padding: 16px;
    border: none;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
    margin-top: 12px;
}
.btn-primary {
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    color: white;
    box-shadow: 0 4px 20px var(--glow);
}
.btn-primary:active { transform: scale(0.98); }
.btn-primary:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* === PROCESSING === */
.processing { text-align: center; padding: 40px 0; }
.spinner {
    width: 60px; height: 60px;
    border: 3px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 20px;
}
.stage-text { font-size: 15px; color: var(--text2); }
.stages-progress {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-top: 16px;
}
.stage-dot {
    width: 8px; height: 8px;
    border-radius: 50%;
    background: var(--border);
    transition: all 0.3s;
}
.stage-dot.done { background: var(--success); }
.stage-dot.active {
    background: var(--accent);
    animation: pulse-dot 1s infinite;
}
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.5); }
}

/* === REPORT PREVIEW === */
.report-card {
    background: var(--surface);
    border-radius: 16px;
    padding: 16px;
    margin-bottom: 12px;
    border: 1px solid var(--border);
}
.report-header {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 12px;
}
.domain-badge {
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 700;
    background: var(--accent);
    color: white;
}
.swot-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    margin-top: 12px;
}
.swot-cell {
    padding: 12px;
    border-radius: 12px;
    font-size: 13px;
}
.swot-s { background: rgba(16, 185, 129, 0.15); border: 1px solid rgba(16, 185, 129, 0.3); }
.swot-w { background: rgba(239, 68, 68, 0.15); border: 1px solid rgba(239, 68, 68, 0.3); }
.swot-o { background: rgba(59, 130, 246, 0.15); border: 1px solid rgba(59, 130, 246, 0.3); }
.swot-t { background: rgba(245, 158, 11, 0.15); border: 1px solid rgba(245, 158, 11, 0.3); }
.swot-label { font-weight: 700; margin-bottom: 6px; font-size: 12px; text-transform: uppercase; }

/* === HISTORY === */
.history-item {
    background: var(--surface);
    border-radius: 12px;
    padding: 14px;
    margin-bottom: 8px;
    border: 1px solid var(--border);
    cursor: pointer;
    transition: border-color 0.2s;
}
.history-item:active { border-color: var(--accent); }
.history-meta { font-size: 12px; color: var(--text2); }
.history-title { font-weight: 600; margin-top: 4px; }

/* === FILE UPLOAD === */
.upload-zone {
    border: 2px dashed var(--border);
    border-radius: 16px;
    padding: 30px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
}
.upload-zone:active { border-color: var(--accent); background: rgba(124, 58, 237, 0.05); }
.upload-icon { font-size: 40px; margin-bottom: 8px; }
.upload-text { font-size: 14px; color: var(--text2); }

/* === BOTTOM NAV === */
.bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0; right: 0;
    background: var(--surface);
    border-top: 1px solid var(--border);
    display: flex;
    padding: 8px 0;
    padding-bottom: max(8px, env(safe-area-inset-bottom));
}
.nav-item {
    flex: 1;
    text-align: center;
    padding: 6px 0;
    cursor: pointer;
    transition: color 0.2s;
    color: var(--text2);
}
.nav-item.active { color: var(--accent); }
.nav-icon { font-size: 22px; }
.nav-label { font-size: 10px; margin-top: 2px; }
.spacer { height: 70px; }
</style>
</head>
<body>

<div class="header">
    <div class="logo">üß†</div>
    <div class="title">–¶–∏—Ñ—Ä–æ–≤–æ–π –£–º–Ω–∏–∫</div>
    <div class="subtitle">AI-—ç–∫—Å–ø–µ—Ä—Ç –≤ –ª—é–±–æ–π –æ–±–ª–∞—Å—Ç–∏</div>
</div>

<div class="tabs" id="tabs">
    <div class="tab active" data-tab="analyze">üéØ –ê–Ω–∞–ª–∏–∑</div>
    <div class="tab" data-tab="record">üé§ –ó–∞–ø–∏—Å—å</div>
    <div class="tab" data-tab="history">üìã –ò—Å—Ç–æ—Ä–∏—è</div>
</div>

<div class="content">
    <!-- ANALYZE TAB -->
    <div class="panel active" id="panel-analyze">
        <div class="input-card">
            <div class="input-label">üîó –°—Å—ã–ª–∫–∞ –Ω–∞ –∫–æ–Ω—Ç–µ–Ω—Ç</div>
            <input class="url-input" id="urlInput" placeholder="YouTube, Google Drive, Dropbox..." type="url">
            <button class="action-btn btn-primary" id="analyzeBtn" onclick="startAnalysis()">
                üß† –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å
            </button>
        </div>
        
        <div class="input-card">
            <div class="input-label">üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª</div>
            <div class="upload-zone" onclick="document.getElementById('fileInput').click()">
                <div class="upload-icon">üì§</div>
                <div class="upload-text">–ê—É–¥–∏–æ –∏–ª–∏ –≤–∏–¥–µ–æ —Ñ–∞–π–ª<br><small>MP3, MP4, WAV, M4A –¥–æ 500MB</small></div>
            </div>
            <input type="file" id="fileInput" accept="audio/*,video/*" hidden onchange="handleFile(this)">
        </div>
    </div>
    
    <!-- RECORD TAB -->
    <div class="panel" id="panel-record">
        <div class="input-card" style="text-align: center; padding: 40px 20px;">
            <div class="input-label">üé§ –ó–∞–ø–∏—Å—å –∞—É–¥–∏–æ</div>
            <div class="record-section">
                <button class="record-btn" id="recordBtn" onclick="toggleRecord()">
                    <svg viewBox="0 0 24 24"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm-1-9c0-.55.45-1 1-1s1 .45 1 1v6c0 .55-.45 1-1 1s-1-.45-1-1V5z"/><path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/></svg>
                </button>
                <div class="record-time" id="recordTime">00:00</div>
            </div>
            <p style="font-size: 13px; color: var(--text2); margin-top: 16px;">
                –ù–∞–∂–º–∏ –¥–ª—è –∑–∞–ø–∏—Å–∏.<br>–ù–∞–∂–º–∏ –µ—â—ë —Ä–∞–∑ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ –∞–Ω–∞–ª–∏–∑.
            </p>
        </div>
    </div>
    
    <!-- HISTORY TAB -->
    <div class="panel" id="panel-history">
        <div id="historyList">
            <div style="text-align: center; padding: 40px; color: var(--text2);">
                <div style="font-size: 40px; margin-bottom: 12px;">üìã</div>
                –û—Ç—á—ë—Ç—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å<br>–ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
            </div>
        </div>
    </div>
    
    <!-- PROCESSING -->
    <div class="panel" id="panel-processing">
        <div class="processing">
            <div class="spinner"></div>
            <div class="stage-text" id="stageText">üîç –û–ø—Ä–µ–¥–µ–ª—è—é –∏—Å—Ç–æ—á–Ω–∏–∫...</div>
            <div class="stages-progress" id="stagesProgress"></div>
        </div>
    </div>
    
    <!-- REPORT -->
    <div class="panel" id="panel-report"></div>
</div>

<div class="spacer"></div>

<div class="bottom-nav">
    <div class="nav-item active" data-tab="analyze">
        <div class="nav-icon">üéØ</div>
        <div class="nav-label">–ê–Ω–∞–ª–∏–∑</div>
    </div>
    <div class="nav-item" data-tab="record">
        <div class="nav-icon">üé§</div>
        <div class="nav-label">–ó–∞–ø–∏—Å—å</div>
    </div>
    <div class="nav-item" data-tab="history">
        <div class="nav-icon">üìã</div>
        <div class="nav-label">–ò—Å—Ç–æ—Ä–∏—è</div>
    </div>
</div>

<script>
const tg = window.Telegram?.WebApp;
if (tg) {
    tg.expand();
    tg.enableClosingConfirmation();
}

// Tab switching
document.querySelectorAll('.tab, .nav-item').forEach(el => {
    el.addEventListener('click', () => {
        const tab = el.dataset.tab;
        if (!tab) return;
        document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.dataset.tab === tab));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.toggle('active', n.dataset.tab === tab));
        document.querySelectorAll('.panel').forEach(p => p.classList.toggle('active', p.id === `panel-${tab}`));
    });
});

// Analysis
function startAnalysis() {
    const url = document.getElementById('urlInput').value.trim();
    if (!url) return;
    
    if (tg) {
        tg.sendData(JSON.stringify({ action: 'analyze', url: url }));
    }
    showProcessing();
}

function handleFile(input) {
    if (input.files.length > 0) {
        const file = input.files[0];
        if (tg) {
            tg.sendData(JSON.stringify({ action: 'upload', filename: file.name }));
        }
        showProcessing();
    }
}

// Recording
let recording = false;
let mediaRecorder = null;
let recordTimer = null;
let recordSeconds = 0;

function toggleRecord() {
    if (!recording) startRecording();
    else stopRecording();
}

async function startRecording() {
    try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        mediaRecorder = new MediaRecorder(stream);
        const chunks = [];
        
        mediaRecorder.ondataavailable = e => chunks.push(e.data);
        mediaRecorder.onstop = () => {
            const blob = new Blob(chunks, { type: 'audio/ogg' });
            stream.getTracks().forEach(t => t.stop());
            if (tg) {
                tg.sendData(JSON.stringify({ action: 'recording_done' }));
            }
            showProcessing();
        };
        
        mediaRecorder.start();
        recording = true;
        document.getElementById('recordBtn').classList.add('recording');
        recordSeconds = 0;
        recordTimer = setInterval(() => {
            recordSeconds++;
            const m = Math.floor(recordSeconds / 60).toString().padStart(2, '0');
            const s = (recordSeconds % 60).toString().padStart(2, '0');
            document.getElementById('recordTime').textContent = `${m}:${s}`;
        }, 1000);
    } catch (e) {
        alert('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É');
    }
}

function stopRecording() {
    if (mediaRecorder) mediaRecorder.stop();
    recording = false;
    document.getElementById('recordBtn').classList.remove('recording');
    clearInterval(recordTimer);
}

// Processing animation
const stages = [
    'üîç –û–ø—Ä–µ–¥–µ–ª—è—é –∏—Å—Ç–æ—á–Ω–∏–∫...',
    'üéµ –ò–∑–≤–ª–µ–∫–∞—é –∞—É–¥–∏–æ...',
    'üìù –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É—é...',
    'üß© –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é —Ç–µ–º—ã...',
    'üß† –ü–æ–≥—Ä—É–∂–∞—é—Å—å –≤ —ç–∫—Å–ø–µ—Ä—Ç–∏–∑—É...',
    'üìä –§–æ—Ä–º–∏—Ä—É—é –æ—Ç—á—ë—Ç...'
];
let currentStage = 0;

function showProcessing() {
    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
    document.getElementById('panel-processing').classList.add('active');
    
    const progress = document.getElementById('stagesProgress');
    progress.innerHTML = stages.map((_, i) => `<div class="stage-dot" id="dot-${i}"></div>`).join('');
    
    currentStage = 0;
    advanceStage();
}

function advanceStage() {
    if (currentStage >= stages.length) return;
    
    document.getElementById('stageText').textContent = stages[currentStage];
    for (let i = 0; i < stages.length; i++) {
        const dot = document.getElementById(`dot-${i}`);
        if (i < currentStage) dot.className = 'stage-dot done';
        else if (i === currentStage) dot.className = 'stage-dot active';
        else dot.className = 'stage-dot';
    }
    
    currentStage++;
    if (currentStage < stages.length) {
        setTimeout(advanceStage, 3000 + Math.random() * 2000);
    }
}
</script>
</body>
</html>